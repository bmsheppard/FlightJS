(()=>{"use strict";class t{constructor(t,i){this.name="xBoost",this.x=t,this.y=i,this.width=80,this.height=20,this.color="#8AC926"}}class i{constructor(t,i){this.name="yBoost",this.x=t,this.y=i-100,this.width=40,this.height=120,this.color="#CDE7B0"}}class s{constructor(t,i){this.name="fullBounce",this.x=t,this.y=i,this.width=40,this.height=40,this.color="#FCF300"}}class e{constructor(t,i){this.name="halfBounce",this.x=t,this.y=i,this.width=40,this.height=40,this.color="#F9627D"}}class h{constructor(t,i){this.name="fullEnergy",this.x=t,this.y=i,this.width=40,this.height=40,this.color="purple"}}class n{constructor(t,i){this.name="lastChance",this.x=t,this.y=i-40,this.width=80,this.height=40,this.color="#FFBA08"}}const a=196,o=new Image,r=new Image;function l(t,i){return t=Math.ceil(t),i=Math.floor(i),Math.floor(Math.random()*(i-t)+t)}class d{constructor(t,i,s,e){this.startY=i,this.x=t,this.y=i,this.width=s,this.height=e,this.color="#F7F4EA"}}var c=document.getElementById("gameWindow"),g=c.getContext("2d");const y=c.height+30,u=c.width/8,m=c.width/2,v=-10*c.height,x=c.height-60;var w=new class{constructor(t,i,s){this.size=40,this.x=t,this.vx=0,this.ax=0,this.y=i,this.vy=0,this.ay=0,this.maxVelY=40,this.energyY=20,this.energyX=a,this.arrowEndX=t+30,this.arrowEndY=i-30,this.dir="grow",this.groundHeight=s,this.lost=!1,this.dt=.5,this.bounceType=0,this.color="#FF9505",o.src="../images/Fish.png",r.src="../images/Wing.png",this.flapAngle=0,this.flapDir=0,this.drawEnergy=this.drawEnergy.bind(this),this.shouldSkip=this.shouldSkip.bind(this),this.giveLastChance=this.giveLastChance.bind(this),this.startGame=this.startGame.bind(this)}draw(t=!1){var i=document.getElementById("gameWindow"),s=i.getContext("2d");let e=i.height/2,h=i.width/8;if(t)return s.beginPath(),s.drawImage(o,this.x-36+4,this.y-20,72,40),s.drawImage(r,this.x-10,this.y+6,20,12),s.closePath(),this.x,i.height,this.size,"shrink"===this.dir?(this.arrowEndY+=1,this.arrowEndX-=1,this.arrowEndY>i.height-this.size-30&&(this.dir="grow")):"grow"===this.dir&&(this.arrowEndY-=1,this.arrowEndX+=1,this.arrowEndY<i.height-this.size-90&&(this.dir="shrink")),void s.setTransform(1,0,0,1,0,0);{s.beginPath(),s.save(),s.arc(this.x,this.y,this.size,0,2*Math.PI),s.translate(this.x,this.y);let t=Math.atan(this.vy/this.vx)+Math.PI/16;s.rotate(t),s.translate(-this.x,-this.y),s.drawImage(o,this.x-36,this.y-20,72,40),s.restore(),s.save(),s.translate(this.x,this.y),s.rotate(t),s.translate(-this.x,-this.y),s.translate(this.x+10,this.y+6),this.flapDir?-24===this.flapAngle?this.flapDir=0:this.flapAngle-=8:24===this.flapAngle?this.flapDir=1:this.flapAngle+=8,s.rotate(this.flapAngle*Math.PI/180),s.translate(-this.x-10,-this.y-6),s.drawImage(r,this.x-10,this.y+6,20,12),s.restore(),this.bounceType&&this.giveShield(),s.closePath(),this.drawEnergy(i)}this.vx>0?this.vx-=this.ax*this.dt:this.vx=0,this.x+=this.vx,s.translate(-this.vx,0),this.vy!==this.maxVelY&&(this.vy+=this.ay*this.dt),this.y<this.groundHeight||this.vy<0?(this.y+=this.vy*this.dt,this.y<e?(s.translate(0,-this.vy*this.dt),this.energyY+=this.vy*this.dt):(s.setTransform(1,0,0,1,0,0),s.translate(h-this.x,0),this.energyY=20)):0!==this.bounceType?(this.vy=-this.bounceType*this.vy,this.bounceType=0,this.color="#FF9505"):this.shouldSkip()?this.vy=-1*Math.abs(this.vy):(this.vy=0,this.x=0,this.lost=!0)}drawEnergy(t){this.lost||(this.energyX=Math.min(a,this.energyX+.4));var i=t.getContext("2d");i.beginPath(),i.rect(this.x+t.width-350,this.energyY,200,20),i.fillStyle="#090809",i.fill(),i.closePath(),i.beginPath(),i.rect(this.x+t.width-348,this.energyY+2,this.energyX,16),i.fillStyle="#D7263D",i.fill(),i.closePath(),i.beginPath(),i.rect(this.x+t.width-348+25,this.energyY-2,2,20),i.fillStyle="#FF9505",i.fill(),i.closePath()}shouldSkip(){return console.log(this.vx,Math.atan(this.vy/this.vx)),Math.atan(this.vy/this.vx)<.52&&this.vx>10}reset(t,i){this.x=t,this.vx=0,this.ax=0,this.y=i,this.vy=0,this.ay=0,this.lost=!1,this.energyX=a}flap(){0!==this.vx||0!==this.vy?this.energyX>=25&&(this.energyX=Math.max(this.energyX-25,0),this.vy=Math.max(this.vy-15,-20),this.vx=Math.min(this.vx+3,35)):this.startGame()}startGame(){this.energyX=a,this.ax=.2,this.vx=30,this.vy=-40,this.ay=1}applyItem(t){"xBoost"===t?this.giveBoost():"fullBounce"===t?(this.giveBounce(1.5),this.color="#FCF300"):"halfBounce"===t?(this.giveBounce(.75),this.color="#F9627D"):"fullEnergy"===t?this.energyX=a:"yBoost"==t?(this.vy-=5,this.vx=Math.max(this.vx,5)):"lastChance"==t&&this.giveLastChance()}giveBounce(t){this.bounceType=t}giveBoost(){this.vx=Math.min(this.vx+20,35)}giveLastChance(){this.vx=Math.max(30,this.vx+10),this.vy=-35}giveShield(){var t=document.getElementById("gameWindow").getContext("2d");t.save(),t.arc(this.x,this.y,this.size,0,2*Math.PI),t.globalAlpha=.6,t.fillStyle=this.color,t.fill(),t.restore()}}(u,y,x),f=new class{constructor(){this.items=[],this.notSpecialItem=this.notSpecialItem.bind(this)}drawItems(t,i,s){var e="",h=document.getElementById("gameWindow").getContext("2d");this.items.length>0&&this.items[0].width+this.items[0].x<t&&this.items.shift();for(let n of this.items){let a=10,o=n.x-a,r=n.x+n.width+a,l=n.y-a,d=n.y+n.height+a;i<r&&i>o&&s<d&&s>l&&(e=n.name,this.notSpecialItem(n.name)&&(n.x=t-n.width)),h.beginPath(),h.rect(n.x,n.y,n.width,n.height),h.fillStyle=n.color,h.fill(),h.closePath()}return e}notSpecialItem(t){return"yBoost"!==t}},p=new class{constructor(t,i){this.groundObjs=[0,t,2*t],this.y=i,this.heigth=100,this.canvas=document.getElementById("gameWindow")}draw(t){var i=this.canvas.getContext("2d");this.groundObjs[0]+this.canvas.width<t&&(this.groundObjs.shift(),this.groundObjs.push(this.groundObjs[this.groundObjs.length-1]+this.canvas.width));for(const t of this.groundObjs)i.beginPath(),i.rect(t,this.y,this.canvas.width,100),i.fillStyle="#4A5899",i.fill(),i.closePath()}addHorizontalMarkers(t,i,s){var e=this.canvas.getContext("2d");for(let h=1;h<50;++h){let n=this.canvas.height-h*i,a=5*h;Math.abs(s-n)<this.canvas.height&&(e.beginPath(),e.rect(t,n,this.canvas.width,2),e.fillStyle="#090809",e.font="20px Roboto",e.fillText(a+"m",t,n-2),e.fill(),e.closePath())}}addObj(t){this.groundObjs.push(t)}}(c.width,x),b=new class{constructor(){this.clouds=[],this.addCloud=this.addCloud.bind(this)}addCloud(t,i,s){let e=l(s=Math.min(s,0),i-300+s),h=new d(t,e,300,100);this.clouds.push(h)}resetClouds(){this.clouds[0].x=l(10,this.clouds[0].width);for(let t=1;t<this.clouds.length;++t)this.clouds[t].x=this.clouds[t-1].x+l(this.clouds[t-1].width+100,this.clouds[t-1].width+600)}draw(t,i,s){var e=document.getElementById("gameWindow"),h=e.getContext("2d");h.save(),h.globalCompositeOperation="destination-over",h.globalAlpha=.8;for(let t of this.clouds)t.x=t.x+.8*i,t.y=t.y+.2*s,h.beginPath(),h.rect(t.x,t.y,t.width,t.height),h.fillStyle=t.color,h.fill(),h.closePath();if(h.restore(),0!=this.clouds.length&&this.clouds[0].x<t-this.clouds[0].width){let i=l(e.width,e.width+100);this.addCloud(t+i,e.height,this.clouds[0].y-this.clouds[0].startY),this.clouds.shift()}}};b.addCloud(l(0,c.width/4),c.height,0),b.addCloud(l(c.width/2,c.width),c.height,0),c.width,c.width;var B=!1;function C(){var a=w.x-u,o=w.y-c.height/2;if(document.getElementById("score").innerText=parseInt(a),B){g.clearRect(a,o-c.height,c.width+100,2*c.height);let r=l(0,100+500/w.vx),d=a+c.width,C=Math.max(o-2*c.height,v),E=l(Math.min(o+2*c.height,x-100),C);r<3?f.items.push(new t(d,E)):r<4?f.items.push(new s(d,E)):r<6?f.items.push(new e(d,E)):r<8?f.items.push(new h(d,E)):r<18?f.items.push(new i(d,E)):r<19&&f.items.push(new n(d,x)),p.draw(a),function(t){p.addHorizontalMarkers(t,m,w.y)}(a);let I=f.drawItems(a,w.x,w.y);if(""!==I&&w.applyItem(I),w.draw(),w.y>=c.height/2?b.draw(a,w.vx,0):b.draw(a,w.vx,w.vy),w.lost)return w.reset(u,y),document.getElementById("scoreMenu").style.display="flex",document.getElementById("finalScore").innerText=document.getElementById("score").innerText,B=!1,f.items=[],p.groundObjs=[0,c.width,2*c.width],b.resetClouds(),void document.removeEventListener("keydown",(function(t){32===t.keyCode?(w.flap(),B=!0):27===t.keyCode||80===t.keyCode?pauseGame():65===t.keyCode?w.giveLastChance():83===t.keyCode&&w.giveBoost()}),!0)}else g.clearRect(0,o-c.height,c.width+100,2*c.height),p.draw(a),w.draw(!0),b.draw(a,-1,0);requestAnimationFrame(C)}function E(){document.getElementById("score").style.display="none",document.body.insertAdjacentHTML("afterbegin",'\n    <div id="gameMenu">\n      <button id="playButton">Play</button>\n      <button id="instructionButton">How to Play</button>\n    </div>\n  ')}E?E():C();let I=document.getElementById("playButton"),M=(document.getElementById("instructionButton"),document.getElementById("replayButton"));I.addEventListener("click",(()=>{document.addEventListener("keydown",(function(t){32===t.keyCode?(w.flap(),B=!0):27===t.keyCode||80===t.keyCode?pauseGame():65===t.keyCode?w.giveLastChance():83===t.keyCode&&w.giveBoost()})),C(),document.getElementById("score").style.display="flex",document.getElementById("gameMenu").outerHTML=""})),M.addEventListener("click",(()=>{document.getElementById("scoreMenu").style.display="none",C()}))})();